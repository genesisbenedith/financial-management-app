<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BudgetController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">csc335-final-project</a> &gt; <a href="index.source.html" class="el_package">csc335.app.controllers</a> &gt; <span class="el_source">BudgetController.java</span></div><h1>BudgetController.java</h1><pre class="source lang-java linenums">package csc335.app.controllers;

import csc335.app.models.Budget;
import csc335.app.models.Category;
import io.github.palexdev.materialfx.controls.MFXNotificationCenter;
// import io.github.palexdev.materialfx.notifications.MFXNotification;
// import io.github.palexdev.materialfx.notifications.MFXNotificationCenterHandler;
import io.github.palexdev.materialfx.controls.MFXSpinner;
import javafx.fxml.FXML;
import javafx.scene.control.*;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.image.ImageView;
import javafx.scene.input.KeyCode;
import javafx.scene.layout.AnchorPane;
import javafx.scene.layout.Pane;

import java.io.*;
import java.util.Map;

<span class="nc" id="L20">public class BudgetController {</span>
    @FXML
    private MFXNotificationCenter notificationCenter;

    @FXML
    private AnchorPane contentArea;

    //Spinners for each category
    @FXML
    private MFXSpinner&lt;Double&gt; fSpinner;
    @FXML
    private MFXSpinner&lt;Double&gt; tSpinner;
    @FXML
    private MFXSpinner&lt;Double&gt; uSpinner;
    @FXML
    private MFXSpinner&lt;Double&gt; hSpinner;
    @FXML
    private MFXSpinner&lt;Double&gt; eSpinner;
    @FXML
    private MFXSpinner&lt;Double&gt; oSpinner;

    // Panes for each category
    @FXML
    private Pane transportation;
    @FXML
    private Pane utilities;
    @FXML
    private Pane health;
    @FXML
    private Pane other;
    @FXML
    private Pane entertainment;
    @FXML
    private Pane food;
    @FXML
    private Pane root;

    // ProgressBars for each category
    @FXML
    private ProgressIndicator foodProgress;
    @FXML
    private ProgressIndicator transportationProgress;
    @FXML
    private ProgressIndicator utilitiesProgress;
    @FXML
    private ProgressIndicator healthProgress;
    @FXML
    private ProgressIndicator entertainmentProgress;
    @FXML
    private ProgressIndicator otherProgress;
    @FXML
    private NavController navigation;

    //Alert Images for each category
    @FXML
    private ImageView tAlert;
    @FXML
    private ImageView eAlert;
    @FXML
    private ImageView uAlert;
    @FXML
    private ImageView hAlert;
    @FXML
    private ImageView fAlert;
    @FXML
    private ImageView oAlert;

    @FXML
private void initialize() {
<span class="nc bnc" id="L89" title="All 12 branches missed.">    if(eSpinner == null &amp;&amp; uSpinner == null &amp;&amp; fSpinner == null &amp;&amp; hSpinner == null &amp;&amp; tSpinner == null &amp;&amp; oSpinner == null){</span>
<span class="nc" id="L90">    eSpinner.getSpinnerModel().setValue(0.0);</span>
<span class="nc" id="L91">    uSpinner.getSpinnerModel().setValue(0.0);</span>
<span class="nc" id="L92">    fSpinner.getSpinnerModel().setValue(0.0);</span>
<span class="nc" id="L93">    hSpinner.getSpinnerModel().setValue(0.0);</span>
<span class="nc" id="L94">    tSpinner.getSpinnerModel().setValue(0.0);</span>
<span class="nc" id="L95">    oSpinner.getSpinnerModel().setValue(0.0);</span>
    }
<span class="nc" id="L97">}</span>

@FXML
private void handleBudget(Category category, MFXSpinner&lt;Double&gt; spinner, ProgressIndicator progress, ImageView alert) {
<span class="nc" id="L101">    alert.setVisible(false);</span>

<span class="nc" id="L103">    spinner.setOnKeyPressed(event -&gt; {</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (event.getCode() == KeyCode.ENTER) {</span>
<span class="nc" id="L105">            Double value = spinner.getSpinnerModel().getValue();</span>
<span class="nc bnc" id="L106" title="All 4 branches missed.">            if (value == null || value &lt; 0) {</span>
<span class="nc" id="L107">                showAlert(AlertType.ERROR, &quot;Error&quot;, &quot;Invalid budget value. Cannot be null or negative.&quot;);</span>
<span class="nc" id="L108">                return;</span>
            }

<span class="nc" id="L111">            DashboardController.currentUser.setBudget(category, value);</span>

<span class="nc bnc" id="L113" title="All 2 branches missed.">            for (Budget b : DashboardController.currentUser.getAllBudgets()) {</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">                if (b.getCategory().equals(category)) {</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">                    if (b.isExceeded()) {</span>
<span class="nc" id="L116">                        alert.setVisible(true);</span>
<span class="nc" id="L117">                        progress.setProgress(Math.min(1.0, b.getTotalSpent() / b.getLimit()));</span>
                    }
<span class="nc bnc" id="L119" title="All 2 branches missed.">                    if (b.getLimit() &lt; 0) {</span>
<span class="nc" id="L120">                        showAlert(AlertType.ERROR, &quot;Error&quot;, &quot;Budget cannot be set below zero.&quot;);</span>
<span class="nc" id="L121">                        return;</span>
                    }
                }
<span class="nc" id="L124">            }</span>

<span class="nc" id="L126">            progress.setProgress(Math.min(1.0, value / 100)); // Normalize for example (e.g., value out of 100)</span>
<span class="nc" id="L127">            saveBudgetToFile();</span>
        }
<span class="nc" id="L129">    });</span>
<span class="nc" id="L130">}</span>

// Individual handlers call the generalized method
@FXML
private void handleTransport() {
<span class="nc" id="L135">    handleBudget(Category.TRANSPORTATION, tSpinner, transportationProgress, tAlert);</span>
<span class="nc" id="L136">}</span>

@FXML
private void handleEntertainment() {
<span class="nc" id="L140">    handleBudget(Category.ENTERTAINMENT, eSpinner, entertainmentProgress, eAlert);</span>
<span class="nc" id="L141">}</span>

@FXML
private void handleUtilities() {
<span class="nc" id="L145">    handleBudget(Category.UTILITIES, uSpinner, utilitiesProgress, uAlert);</span>
<span class="nc" id="L146">}</span>

@FXML
private void handleFood() {
<span class="nc" id="L150">    handleBudget(Category.FOOD, fSpinner, foodProgress, fAlert);</span>
<span class="nc" id="L151">}</span>

@FXML
private void handleHealth() {
<span class="nc" id="L155">    handleBudget(Category.HEALTHCARE, hSpinner, healthProgress, hAlert);</span>
<span class="nc" id="L156">}</span>

@FXML
private void handleOther() {
<span class="nc" id="L160">    handleBudget(Category.OTHER, oSpinner, otherProgress, oAlert);</span>
<span class="nc" id="L161">}</span>

    // private void handlePlusButtonPressed(Category category, double newValue) {
    //     System.out.println(&quot;Plus button pressed for &quot; + category + &quot;: New value is &quot; + newValue);
    //     DashboardController.currentUser.setBudget(category, newValue);
    //     updateProgressBar(category);
    //     handleWarning(category, newValue);
    // }

    // private void handleMinusButtonPressed(Category category, double newValue) {
    //     System.out.println(&quot;Minus button pressed for &quot; + category + &quot;: New value is &quot; + newValue);
    //     DashboardController.currentUser.setBudget(category, newValue);
    //     updateProgressBar(category);
    //     handleWarning(category, newValue);
    // }

    @FXML
    private void handleGoToDashboardClick() {
<span class="nc" id="L179">        AuthController.getInstance().loadContent(&quot;/views/DashboardView.fxml&quot;);</span>
<span class="nc" id="L180">    }</span>

    @FXML
    private void handleGoToBudgetClick() {
<span class="nc" id="L184">        AuthController.getInstance().loadContent(&quot;/views/BudgetView.fxml&quot;);</span>
<span class="nc" id="L185">    }</span>

    @FXML
    private void handleGoToLogoutClick(){
<span class="nc" id="L189">        AuthController.getInstance().loadContent(&quot;/views/LogOutView.fxml&quot;);</span>
<span class="nc" id="L190">    }</span>
    
    @FXML
    private void saveBudgetToFile() {
<span class="nc" id="L194">        String username = DashboardController.currentUser.getUsername();</span>
<span class="nc" id="L195">        File userFile = new File(username + &quot;.txt&quot;);</span>

<span class="nc" id="L197">        try (BufferedReader reader = new BufferedReader(new FileReader(userFile));</span>
<span class="nc" id="L198">             StringWriter fileContent = new StringWriter()) {</span>

            String line;
<span class="nc" id="L201">            Map&lt;Category, Budget&gt; budgets = DashboardController.currentUser.getCategorizedBudgets();</span>

<span class="nc bnc" id="L203" title="All 2 branches missed.">            while ((line = reader.readLine()) != null) {</span>
<span class="nc" id="L204">                boolean categoryUpdated = false;</span>

<span class="nc bnc" id="L206" title="All 2 branches missed.">                for (Map.Entry&lt;Category, Budget&gt; entry : budgets.entrySet()) {</span>
<span class="nc" id="L207">                    Category category = entry.getKey();</span>
<span class="nc" id="L208">                    Budget budget = entry.getValue();</span>

<span class="nc bnc" id="L210" title="All 2 branches missed.">                    if (line.startsWith(&quot;Budget: &quot; + category)) {</span>
<span class="nc" id="L211">                        System.out.println(category + &quot; has been updated with limit of &quot; + budget.getLimit() + &quot; and total spent of &quot; + budget.getTotalSpent());</span>
<span class="nc" id="L212">                        fileContent.append(&quot;Budget: &quot;)</span>
<span class="nc" id="L213">                                .append(category.toString())</span>
<span class="nc" id="L214">                                .append(&quot;, &quot;)</span>
<span class="nc" id="L215">                                .append(budget.getLimit() + &quot;&quot;)</span>
<span class="nc" id="L216">                                .append(&quot;, &quot;)</span>
<span class="nc" id="L217">                                .append(budget.getTotalSpent() + &quot;&quot;)</span>
<span class="nc" id="L218">                                .append(&quot;\n&quot;);</span>
<span class="nc" id="L219">                        categoryUpdated = true;</span>
<span class="nc" id="L220">                        break;</span>
                    }
<span class="nc" id="L222">                }</span>

<span class="nc bnc" id="L224" title="All 2 branches missed.">                if (!categoryUpdated) {</span>
<span class="nc" id="L225">                    fileContent.append(line).append(&quot;\n&quot;);</span>
                }
<span class="nc" id="L227">            }</span>

<span class="nc bnc" id="L229" title="All 2 branches missed.">            for (Map.Entry&lt;Category, Budget&gt; entry : budgets.entrySet()) {</span>
<span class="nc" id="L230">                Category category = entry.getKey();</span>
<span class="nc" id="L231">                Budget budget = entry.getValue();</span>

<span class="nc bnc" id="L233" title="All 2 branches missed.">                if (!fileContent.toString().contains(&quot;Budget: &quot; + category)) {</span>
<span class="nc" id="L234">                    System.out.println(category + &quot; has been added with a limit of &quot; + budget.getLimit() + &quot; and total spent of &quot; + budget.getTotalSpent());</span>
<span class="nc" id="L235">                    fileContent.append(&quot;Budget: &quot;)</span>
<span class="nc" id="L236">                            .append(category.toString())</span>
<span class="nc" id="L237">                            .append(&quot;, &quot;)</span>
<span class="nc" id="L238">                            .append(budget.getLimit() + &quot;&quot;)</span>
<span class="nc" id="L239">                            .append(&quot;, &quot;)</span>
<span class="nc" id="L240">                            .append(budget.getTotalSpent() + &quot;&quot;)</span>
<span class="nc" id="L241">                            .append(&quot;\n&quot;);</span>
                }
<span class="nc" id="L243">            }</span>

<span class="nc" id="L245">            try (FileWriter writer = new FileWriter(userFile)) {</span>
<span class="nc" id="L246">                writer.write(fileContent.toString());</span>
            }

<span class="nc" id="L249">        } catch (IOException e) {</span>
<span class="nc" id="L250">            e.printStackTrace();</span>
<span class="nc" id="L251">        }</span>
<span class="nc" id="L252">    }</span>

    /**
     * 
     * @param alertType
     * @param title
     * @param message
     */
    private void showAlert(AlertType alertType, String title, String message) {
<span class="nc" id="L261">        Alert alert = new Alert(alertType);</span>
<span class="nc" id="L262">        alert.setTitle(title);</span>
<span class="nc" id="L263">        alert.setContentText(message);</span>
<span class="nc" id="L264">        alert.showAndWait();</span>
<span class="nc" id="L265">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>